"use strict";const t=require("./api/repository");module.exports=class{constructor(o){if(!o.host)throw new Error("NO_HOST_ERROR");if(!o.token)throw new Error("NO_TOKEN_ERROR");this.host=o.host,this.port=o.port,this.token=o.token,this.protocol=o.protocol||"https",this.apiVersion=o.apiVersion||"v3",this.path_prefix=o.path_prefix?o.path_prefix:"/",this.promise=o.promise||Promise,this.repository=new t(this)}buildURL(t,o){const e=this.path_prefix+"api/"+(o||this.apiVersion)+t,{protocol:r,host:s}=this;return decodeURIComponent(`${r}://${s}${e}`)}async makeRequest(t){const o={method:t.method||"GET",headers:{Authorization:"token "+this.token,...t.headers},uri:t.uri};if(t.qs){const e=Object.keys(t.qs).map(o=>encodeURIComponent(o)+"="+encodeURIComponent(t.qs[o])).join("&");o.uri=`${t.uri}?${e}`}t.body&&(o.body=JSON.stringify(t.body));const{uri:e,...r}=o;try{const t=await fetch(e,r),o=await t.json();return Promise.resolve(o)}catch(t){return Promise.reject(t)}}};
